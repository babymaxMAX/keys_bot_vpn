<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LsJ Comrades ‚Äî –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</title>
  <link rel="stylesheet" href="/public/style.css" />
</head>
<body>
  <div class="notice-bar">–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á</div>
  <div class="container">
    <div class="header">
      <div class="logo">‚öîÔ∏è</div>
      <div class="service-name">LsJ Comrades</div>
      <div class="service-description"><%= label %></div>
    </div>

    <div class="content">
      <button class="connect-button" id="connectBtn">üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPN</button>
      <button class="copy-button" id="copyBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      <div class="protocol-info">
        <div class="protocol-title">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        <div class="protocol-details">VLESS / TCP / Reality ¬∑ SNI: www.samsung.com ¬∑ FP: Chrome</div>
      </div>
    </div>
  </div>

  <div class="copy-notification" id="copyNotification">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!</div>

  <script>
    const originalKey = `<%- vless %>`;
    const configFileUrl = `<%- configUrl %>`;
    const deeplinkUrl = `https://deeplink.website/?url=${encodeURIComponent(configFileUrl)}`;

    function copyToClipboard(text) {
      if (navigator.clipboard) return navigator.clipboard.writeText(text);
      const ta = document.createElement('textarea'); ta.value = text;
      ta.style.position='fixed'; ta.style.left='-99999px'; document.body.appendChild(ta);
      ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      return Promise.resolve();
    }

    function showNote(msg='–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!') {
      const n = document.getElementById('copyNotification');
      n.textContent = msg; n.classList.add('show');
      setTimeout(()=> n.classList.remove('show'), 3500);
    }

    function connect() {
      let attempts = 0, max = 4;
      function tryStep() {
        attempts++;
        try {
          if (attempts === 1) {
            window.location.href = deeplinkUrl;
          } else if (attempts === 2) {
            const a = document.createElement('a');
            a.href = deeplinkUrl; a.style.display='none';
            document.body.appendChild(a); a.click(); a.remove();
          } else if (attempts === 3) {
            window.open(deeplinkUrl, '_blank');
          } else {
            window.location.href = originalKey;
          }
        } catch(e) {}

        if (attempts >= max) {
          setTimeout(async () => {
            await copyToClipboard(originalKey);
            showNote('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é.');
          }, 800);
        } else {
          setTimeout(tryStep, 200);
        }
      }
      setTimeout(tryStep, 100);
    }

    document.getElementById('connectBtn').addEventListener('click', connect);
    document.getElementById('copyBtn').addEventListener('click', async () => {
      await copyToClipboard(originalKey); showNote('–°—Å—ã–ª–∫–∞ v2ray —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    });

    window.addEventListener('load', () => {
      const q = new URLSearchParams(location.search);
      if (q.get('auto') === 'true') setTimeout(connect, 600);
    });
  </script>
</body>
</html>


